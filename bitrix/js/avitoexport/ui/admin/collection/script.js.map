{"version":3,"file":"script.js","sources":["../../../plugin/skeleton.js","../../../plugin/utils.js","src/index.js"],"sourcesContent":["import {compileTemplate} from \"./utils\";\n\n// noinspection JSUnresolvedVariable\nconst $ = window.AvitoJQuery ?? window.$;\n\nexport class Skeleton {\n\n\tstatic defaults = {\n\t\tlang: {},\n\t\tlangPrefix: null\n\t};\n\n\tconstructor(element: HTMLElement, options: Object = {}) {\n\t\tthis.$el = $(element);\n\t\tthis.el = this.$el[0];\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.$el.data(), options);\n\t}\n\n\tdestroy() {\n\t\tthis.el = null;\n\t}\n\t\n\tgetElement(key, context, method) : JQuery {\n\t\tconst selector = this.getElementSelector(key);\n\t\n\t\treturn this.getNode(selector, context, method || 'find');\n\t}\n\t\n\tgetElementSelector(key: string) : string {\n\t\tconst optionKey = key + 'Element';\n\t\n\t\treturn this.options[optionKey];\n\t}\n\t\n\tgetTemplate(key: string) : string {\n\t\tconst optionKey = key + 'Template';\n\t\tconst option = this.options[optionKey];\n\t\tconst optionFirstSymbol = option.substring(0, 1);\n\t\tlet result;\n\t\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\n\t\t\tresult = this.getNode(option).html();\n\t\t} else {\n\t\t\tresult = option;\n\t\t}\n\t\n\t\treturn result;\n\t}\n\t\n\tgetNode(selector, context, method = 'find') : JQuery {\n\t\tif (selector.substring(0, 1) === '#') { // is id query\n\t\t\tcontext = $(document);\n\t\t} else if (!context) {\n\t\t\tcontext = this.$el;\n\t\t}\n\t\n\t\treturn context[method](selector);\n\t}\n\t\n\tgetLang(key, replaces) : string {\n\t\tlet langKey;\n\t\tlet result;\n\t\n\t\tif (this.options.lang != null && key in this.options.lang) {\n\t\t\tresult = this.options.lang[key];\n\t\t} else {\n\t\t\tlangKey = this.options.langPrefix + key;\n\t\t\tresult = BX.message(langKey) || '';\n\t\t}\n\t\n\t\tif (result && replaces) {\n\t\t\tresult = compileTemplate(result, replaces);\n\t\t}\n\t\n\t\treturn result;\n\t}\n}\n","// @flow\n\nexport function compileTemplate(template: string, replaces: Object) {\n\tlet result = template;\n\n\tfor (const key in replaces) {\n\t\tif (!replaces.hasOwnProperty(key)) { continue; }\n\n\t\tconst replaceKey = '#' + key + '#';\n\t\tconst replaceValue = replaces[key];\n\n\t\tdo {\n\t\t\tresult = result.replace(replaceKey, replaceValue);\n\t\t} while (result.indexOf(replaceKey) !== -1);\n\t}\n\n\treturn result;\n}\n\nexport function htmlToElement(html, tag = 'div') {\n\tconst renderer = document.createElement(tag);\n\n\trenderer.innerHTML = html;\n\n\treturn renderer.firstElementChild;\n}","import {Skeleton} from \"../../../../plugin/skeleton\";\n\n\nexport class Collection extends Skeleton {\n\n    static defaults = {\n        inputName: null,\n        itemElement: '.js-input-collection__item',\n        selectElement: '.js-input-collection__select',\n        deleteElement: '.js-input-collection__delete',\n        addElement: '.js-input-collection__add',\n    }\n\n    constructor(element: HTMLElement, options: Object = {}) {\n        super(element, options);\n        this.bind();\n    }\n\n    bind() : void {\n        this.handleDeleteClick(true);\n        this.handleAddClick(true)\n    }\n\n    handleDeleteClick(dir) : void {\n        const button = this.getElement('delete');\n\n        button[dir ? 'on' : 'off']('click', this.delete);\n    }\n\n    handleAddClick(dir) : void {\n        const button = this.getElement('add');\n\n        button[dir ? 'on' : 'off']('click', this.add);\n    }\n\n    delete = (event) : void => {\n        event.preventDefault();\n\n        const currentButton = $(event.target);\n        const item = this.getElement('item', currentButton, 'closest');\n        const addButton = this.getElement('add', item);\n        const prevItem = this.getElement('item', item, 'prev');\n\n        if (prevItem.length === 0 && addButton.length !== 0) {\n            const select = this.getElement('select', item);\n            select.prop('selectedIndex', 0);\n\n            return false;\n        }\n\n        if (addButton.length !== 0) {\n            addButton.clone(true).appendTo(prevItem.find('td'));\n        }\n\n        item.remove();\n\n        this.recalculateIndexes();\n    }\n\n    add = (event) : void => {\n        event.preventDefault();\n\n        const currentButton = $(event.target);\n        const item = this.getElement('item', currentButton, 'closest');\n\n        const newItem = item.clone(true, true).insertAfter(item);\n        currentButton.remove();\n\n        const newSelect = this.getElement('select', newItem);\n\n        const index = parseInt(newSelect.data('index')) + 1;\n\n        this.changeNameIndex(newSelect, index);\n    }\n\n    recalculateIndexes() : void {\n        const items = this.getElement('item');\n\n        items.each((index, item) => {\n            const select = this.getElement('select', $(item));\n\n            this.changeNameIndex(select, index);\n        });\n    }\n\n    changeNameIndex(select, index) : void {\n        select.prop('name', `${this.options.inputName}[${index}]`);\n        select.data('index', index);\n        select.attr('data-index', index);\n    }\n}"],"names":["$","window","AvitoJQuery","Skeleton","constructor","element","options","$el","el","this","Object","assign","defaults","data","destroy","getElement","key","context","method","selector","getElementSelector","getNode","optionKey","getTemplate","option","optionFirstSymbol","substring","result","html","document","getLang","replaces","langKey","lang","langPrefix","BX","message","template","hasOwnProperty","replaceKey","replaceValue","replace","indexOf","compileTemplate","Collection","delete","event","preventDefault","currentButton","target","item","addButton","prevItem","length","prop","clone","appendTo","find","remove","recalculateIndexes","add","newItem","insertAfter","newSelect","index","parseInt","changeNameIndex","bind","handleDeleteClick","handleAddClick","dir","each","select","inputName","attr","itemElement","selectElement","deleteElement","addElement"],"mappings":"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"}